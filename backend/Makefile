.PHONY: help build run test seed db-up db-down clean

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
.DEFAULT_GOAL := help

# ãƒ˜ãƒ«ãƒ—
help:
	@echo "åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
	@echo "  make build      - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰"
	@echo "  make run        - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ"
	@echo "  make test       - ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
	@echo "  make seed       - ç¨®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥"
	@echo "  make db-up      - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èµ·å‹•"
	@echo "  make db-down    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åœæ­¢"
	@echo "  make clean      - ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’å‰Šé™¤"

# ãƒ“ãƒ«ãƒ‰
build:
	go build -o bin/noraneko-id cmd/server/main.go

# å®Ÿè¡Œ
run:
	go run cmd/server/main.go

# ãƒ†ã‚¹ãƒˆ
test:
	go test -v ./...

# ç¨®ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
seed:
	@echo "ğŸŒ± ç¨®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¦ã„ã¾ã™..."
	go run cmd/seed/main.go

# ç‰¹å®šã®ã‚·ãƒ¼ãƒ€ãƒ¼ã®ã¿å®Ÿè¡Œ
seed-only:
	@echo "ğŸŒ± ç‰¹å®šã®ç¨®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¦ã„ã¾ã™..."
	@echo "ä¾‹: make seed-only SEEDERS=ãƒ¦ãƒ¼ã‚¶ãƒ¼,ç®¡ç†è€…æ¨©é™"
	go run cmd/seed/main.go -only "$(SEEDERS)"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èµ·å‹•
db-up:
	docker-compose up -d

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åœæ­¢
db-down:
	docker-compose down

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†èµ·å‹•ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆï¼‰
db-reset: db-down
	docker-compose down -v
	docker-compose up -d
	@echo "â³ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èµ·å‹•ã‚’å¾…ã£ã¦ã„ã¾ã™..."
	@sleep 5
	@echo "ğŸŒ± ç¨®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¦ã„ã¾ã™..."
	go run cmd/seed/main.go

# ã‚¯ãƒªãƒ¼ãƒ³
clean:
	rm -rf bin/

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
dev:
	@which air > /dev/null || (echo "airã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„: go install github.com/cosmtrek/air@latest" && exit 1)
	air

# ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
deps:
	go mod download
	go mod tidy

# ãƒªãƒ³ãƒˆ
lint:
	@which golangci-lint > /dev/null || (echo "golangci-lintã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„: https://golangci-lint.run/usage/install/" && exit 1)
	golangci-lint run

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
fmt:
	go fmt ./...